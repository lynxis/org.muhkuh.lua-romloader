language: c


env:
  global:
    - secure: "JQR2MRfSzKiI5gQF+FWUaJYO3TG7b7GQtVVMI6g33J7aYjFo7SEMZvxBhHOF/G1IkSNGNBvLDbxPTKZsBUHHV33orhMSr3E0kkwwKwpPON2wVVe9eSA8paj/t/r3U0p8QdGa7PP75ahFmpRCh2P5XGJDtghi5s1gcuBRpts9o8m/bRLZNjqI1Cd5w8AqTDgl/xbRsoCD8eqett6rn8DrXemFTpaxb0oYN5Y74jjCx560oouCRRSwC3qghstBChTRw7PFTVr2WWicB2pEN2/ttAZ63/pdJm9XeWDTf47QWI3/kAegyy/aMQhO+mcfT9RAdcckuf8T2z8NHqkMiH8rh5QdkBJIbf9mQPM4tcGc2IXQOonVboeLI7SD4VJzw8g9SDEiGbL6YOIN4jamQcQkgNkueh4v6V8XgjBkSd5vThw3upHfgH84LzZ3buMuJtD4Hl0SaMJEaqHzByMtQ1vQ6PE9qyz8vo8MmOzTqFQxUveJNMlpc7mwrc108c26ml1HdgUFbXVJi/rgxTSNbmptJj9oSuj8hdOC/mmSN8JO+RclFHQMVPNLJQnZuf7XiAfuj9wY5kxwvxoIstKqLxRI4xRTXyeN+ttN3JyjU0j3wlwGpuFcd5JK+SS8GH2rOSoouBj3NQAoDmujvOcYsSUYkTDshkUrbVNof+OE1wFLun8="
    - PATH=/usr/mingw-w64-i686/bin:/usr/mingw-w64-x86_64/bin:/tmp/apache-ant-1.9.6/bin:${PATH}


before_install:
  - sudo dpkg --purge cmake cmake-doc cmake-data
  - curl http://download.opensuse.org/repositories/home:/doc_bacardi/xUbuntu_12.04/Release.key | sudo apt-key add -
  - echo "deb http://download.opensuse.org/repositories/home:/doc_bacardi/xUbuntu_12.04 ./" | sudo tee -a /etc/apt/sources.list
  - sudo apt-get update -qq
  - sudo apt-get --assume-yes install mingw-w64-mbs
  - sudo apt-get --assume-yes install swig3 cmake3
  - sudo apt-get --assume-yes install python-pip python-virtualenv
  - wget http://downloads.sourceforge.net/project/muhkuh/mbs/org/apache/ant/1.9.6/apache-ant-1.9.6-bin.tar.bz2 -O /tmp/apache-ant-1.9.6-bin.tar.bz2
  - tar --directory /tmp --extract --bzip2 --file /tmp/apache-ant-1.9.6-bin.tar.bz2
  - virtualenv ~/virtualenv/python2.7
  - source ~/virtualenv/python2.7/bin/activate
  - pip install -q requests


# This is the command to build the whole project and pack the results in a distributable form.
script:
  - ./.build.sh


after_success:
  - python installer/ivy/deploy.py build/artifacts/artifacts_lua_plugin_romloader.xml


# Deploy the artifacts to GitHub.
deploy:
  provider: releases
  api_key:
    secure: "O5aPC2wB22pQ7dbVdy5dhCpWovCDB6oaat3vZBh7SyPDCSPWx5DO67jBiR/+tAMWODmLt0T4xTLXCaZlNfqUQlCDQTzJv7FvX1pLCq/nhNRhTQ1HVkmWsQY1GTHJ4qHPjhXlvPFDQkQ4uQQMArpde45w+Qi3qfl1N5/IElCrDT8="
  file:
    - build/ivy.xml
    - build/lua51-romloader.zip
  skip_cleanup: true
  on:
    repo: muhkuh-sys/org.muhkuh.lua-lua51-romloader
    tags: true
